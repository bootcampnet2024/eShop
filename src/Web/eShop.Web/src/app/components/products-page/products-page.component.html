<app-header></app-header>
<app-navbar></app-navbar>
<div class="all-products-page">
  <p class="all-products-page-category-name">{{ categoryName }}</p>
  <div class="all-products-page__product-container">
    <div class="all-products-page__filter_by">
      <p>Brands</p>
      <div class="all-products-page__brands-filter">
        @for (brand of brands; track brand.id) {
        <div class="all-products-page__brand">
          <input
            type="checkbox"
            name="brand"
            [value]="brand.id"
            (change)="onBrandChange($event, brand.id)"
            [checked]="brandsIds.includes(brand.id)"
          />
          <label for="brand">{{ brand.name }}</label>
        </div>
        }
      </div>
    </div>
    <div class="all-products-page__product-container2">
      <div class="all-products-page__control-buttons">
        <div class="all-products-page__control-button">
          <p>Sort By:</p>
          <select [(ngModel)]="sortBy" (change)="onSortByChange($event)">
            @for (sortType of sortByTypes; track $index) {
            <option [value]="sortType">{{ sortType }}</option>
            }
          </select>
        </div>
        <div class="all-products-page__control-button">
          <p>Show:</p>
          <select [(ngModel)]="pageSize" (change)="onPageSizeChange($event)">
            @for (size of pageSizes; track $index) {
            <option [value]="size">{{ size }} products per page</option>
            }
          </select>
        </div>
      </div>
      <section class="all_procucts-page__product-container">
        @for (product of products; track product.id) {
          <div class="product-display">
            <div class="product-card" (click)="viewProduct(product)">
              <div class="image-placeholder">
                <img
                  loading="eager"
                  src="{{ product.imageURL }}"
                  [alt]="product.name"
                  
                  class="product-image"
                />
              </div>
              <div class="product-info">
                <a (click)="viewProduct(product)" class="product-name">{{
                  product.name
                }}</a>
                <div class="product-price-tag">
                  @if(product.discount && product.quantity > 0){
                    <div class="product-discount-price">
                      <p class="product-original-price">R$ {{ product.price.toFixed(2) }}</p>
                      <div class="product-finalprice-discount">
                        <p class="product-price">R$ {{ product.finalPrice.toFixed(2) }}</p>
                        <p class="product-discount">{{ product.discount }}% OFF</p>
                      </div>
                    </div>
                    } @else if (product.quantity > 0){
                    <p class="product-price">R${{ product.finalPrice.toFixed(2) }}</p>
                    } @else {
                    <p class="product-price">Out of Stock!</p>
                    }
                </div>
              </div>
            </div>
          </div>
        }
      </section>
      <div class="change-page-buttons">
        <button [ngClass]="this.pageIndex != 0 ? 'change-page-buttons__button' : 'invisible'" (click)="goToPreviousPage()">
          Previous
        </button>
        @if(pageIndex > 2){
        <button class="change-page-buttons__page-index" (click)="goToFirstPage()">
          1
        </button>
        <span>...</span>
        }
        @for (number of numbers; track numbers){
          <button [ngClass]="this.pageIndex == number - 1 ? 'change-page-buttons__page-index--selected' : 'change-page-buttons__page-index'" (click)="goToPage(number)">{{number}}</button>
        }
        @if(pageIndex < maxPage - 3){
          <span>...</span>
        <button class="change-page-buttons__page-index" (click)="goToLastPage()">
          {{this.maxPage}}
        </button>
        }
        <button [ngClass]="this.maxPage - 1 > this.pageIndex ? 'change-page-buttons__button' : 'invisible'" (click)="goToNextPage()">
          Next
        </button>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
